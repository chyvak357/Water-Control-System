<html>
<head>
	<title>Particle Login Example</title>
</head>


<body>
<script type="module" src="https://cdn.jsdelivr.net/particle-api-js/5/particle.min.js"></script>
<script src="require.js"></script>
<script>


    //var particle;
    //var Particle = require('particle-api-js');

	// Вот тут мы вызываем  функции
    require(['https://cdn.jsdelivr.net/particle-api-js/5/particle.min.js'], function (api) {

        var Particle = api;
        var particle = new Particle();
        var token;

        particle.login({username: 'chyvak357@gmail.com', password: '47904790'}).then(
            function(data) {
                // Только в этом месте есть токен
                token = data.body.access_token;
                console.log('login success 1', token);
                // list(particle, token);
            }).then(function (data){
            	token = data.body.access_token;



			}).then(function (err) {
            	console.log('Could not log in.', err);
        	}
		);

        console.log('login success 2', token);

        //list(particle, token);



        /*
        particle.signalDevice({ deviceId: '4d0046000e51353532343635', signal: true, auth: token }).then(function(data) {
            console.log('Device is shouting rainbows:', data);
        }, function(err) {
            console.log('Error sending a signal to the device:', err);
        });
        */
    });


	// Вот тут мы описывем функции
    function list(particle, token) {
        var devicesPr = particle.listDevices({ auth: token });

        //	var token;
        console.log('login success 2 ', token);


        devicesPr.then(
            function(devices){
                console.log('Devices: ', devices);
            },
            function(err) {
                console.log('List devices call failed: ', err);
            }
        );


    };




</script>
</body>
</html>


